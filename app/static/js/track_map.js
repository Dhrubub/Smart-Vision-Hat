ship_data = {
	vessels: [
		{
			'Vessel Name': 'COSCO GENOA',
			'Ports Visited': [
				{
					'Port Name': 'Mesaieed',
					'Product Type': 'Urea',
					Quantity: 4500,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Donaldsonville',
					'Product Type': 'UAN',
					Quantity: 3200,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Aqaba',
					'Product Type': 'MOP',
					Quantity: 2800,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'YU PENG',
			'Ports Visited': [
				{
					'Port Name': 'Al Jubail',
					'Product Type': 'Urea',
					Quantity: 4700,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Port Lisas',
					'Product Type': 'UAN',
					Quantity: 3500,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Ras Al Khair',
					'Product Type': 'MAP',
					Quantity: 3100,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'ISLAND EXPRESS',
			'Ports Visited': [
				{
					'Port Name': 'Bontang',
					'Product Type': 'Urea',
					Quantity: 4900,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Novorossiysk',
					'Product Type': 'UAN',
					Quantity: 3400,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Portland',
					'Product Type': 'MOP',
					Quantity: 2900,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'PALAWAN',
			'Ports Visited': [
				{
					'Port Name': 'Sitra',
					'Product Type': 'Urea',
					Quantity: 4600,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Sipitang',
					'Product Type': 'UAN',
					Quantity: 3300,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Ras Al Khair',
					'Product Type': 'MAP',
					Quantity: 2900,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'CAPE PILLAR',
			'Ports Visited': [
				{
					'Port Name': 'Sipitang',
					'Product Type': 'Urea',
					Quantity: 4800,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Aqaba',
					'Product Type': 'UAN',
					Quantity: 3200,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Ras Al Khair',
					'Product Type': 'MAP',
					Quantity: 2700,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'MSC LIDIA',
			'Ports Visited': [
				{
					'Port Name': 'Mesaieed',
					'Product Type': 'Urea',
					Quantity: 4700,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Donaldsonville',
					'Product Type': 'UAN',
					Quantity: 3400,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Aqaba',
					'Product Type': 'MOP',
					Quantity: 2800,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'APL MEXICO CITY',
			'Ports Visited': [
				{
					'Port Name': 'Mesaieed',
					'Product Type': 'Urea',
					Quantity: 4600,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Port Lisas',
					'Product Type': 'UAN',
					Quantity: 3300,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Portland',
					'Product Type': 'MOP',
					Quantity: 2900,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'TAHO AFRICA',
			'Ports Visited': [
				{
					'Port Name': 'Sitra',
					'Product Type': 'Urea',
					Quantity: 4800,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Novorossiysk',
					'Product Type': 'UAN',
					Quantity: 3200,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Portland',
					'Product Type': 'MOP',
					Quantity: 2700,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'HMPNGS GILBERT TOROPO',
			'Ports Visited': [
				{
					'Port Name': 'Mesaieed',
					'Product Type': 'Urea',
					Quantity: 4600,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Sipitang',
					'Product Type': 'UAN',
					Quantity: 3300,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Ras Al Khair',
					'Product Type': 'MAP',
					Quantity: 2900,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
		{
			'Vessel Name': 'MITERA',
			'Ports Visited': [
				{
					'Port Name': 'Bontang',
					'Product Type': 'Urea',
					Quantity: 4800,
					'FOB Price per Unit in AUD': 300,
				},
				{
					'Port Name': 'Novorossiysk',
					'Product Type': 'UAN',
					Quantity: 3200,
					'FOB Price per Unit in AUD': 350,
				},
				{
					'Port Name': 'Portland',
					'Product Type': 'MOP',
					Quantity: 2700,
					'FOB Price per Unit in AUD': 280,
				},
			],
		},
	],
	ports: [
		{
			Country: 'Jordan',
			Function: 'Unknown',
			LOCODE: 'JO AQJ',
			Name: 'Al Aqabah',
			NameWoDiac: 'Al Aqabah',
			Status: 'AI',
			lat: 29.516667,
			long: 35.0,
			outflows: 6340518,
		},
		{
			Country: 'Indonesia',
			Function: 'Unknown',
			LOCODE: 'ID BXT',
			Name: 'Bontang Lng Terminal',
			NameWoDiac: 'Bontang Lng Terminal',
			Status: 'AI',
			lat: 0.1,
			long: 117.483333,
			outflows: 6783296,
		},
		{
			Country: 'Russia',
			Function: 'Unknown',
			LOCODE: 'RU NVS',
			Name: 'Novorossiysk',
			NameWoDiac: 'Novorossiysk',
			Status: 'AI',
			lat: 44.716667,
			long: 37.783333,
			outflows: 7891578,
		},
		{
			Country: 'United States',
			Function: 'Unknown',
			LOCODE: 'US PWM',
			Name: 'Portland',
			NameWoDiac: 'Portland',
			Status: 'AI',
			lat: 43.666667,
			long: -70.25,
			outflows: 7353495,
		},
		{
			Country: 'Bahrain',
			Function: 'Unknown',
			LOCODE: 'BH SIT',
			Name: 'Sitrah',
			NameWoDiac: 'Sitrah',
			Status: 'AI',
			lat: 26.166667,
			long: 50.666667,
			outflows: 1436192,
		},
		{
			Country: 'Qatar',
			Function: '1----6--',
			LOCODE: 'QAMES',
			Name: 'Mesaieed',
			NameWoDiac: 'Mesaieed',
			Status: 'RQ',
			lat: 25.633333333333333,
			long: 51.916666666666664,
			outflows: 87230.0,
		},
		{
			Country: 'Saudi Arabia',
			Function: 'Unknown',
			LOCODE: 'Unknown',
			Name: 'Al Jubail',
			NameWoDiac: 'Al Jubail',
			Status: 'AI',
			lat: 27.933333,
			long: 35.25,
			outflows: 400071,
		},
		{
			Country: 'United States',
			Function: 'Unknown',
			LOCODE: 'Unknown',
			Name: 'Donaldsonville',
			NameWoDiac: 'Donaldsonville',
			Status: 'AI',
			lat: 40.533333,
			long: -74.25,
			outflows: 789083,
		},
		{
			Country: 'Trinidad and Tobago',
			Function: 'Unknown',
			LOCODE: 'Unknown',
			Name: 'Port Lisas',
			NameWoDiac: 'Port Lisas',
			Status: 'AI',
			lat: 10.2,
			long: -61.7,
			outflows: 1262443,
		},
		{
			Country: 'Saudi Arabia',
			Function: 'Unknown',
			LOCODE: 'Unknown',
			Name: 'Ras Al Khair',
			NameWoDiac: 'Ras Al Khair',
			Status: 'AI',
			lat: 27.933333,
			long: 35.25,
			outflows: 7409830,
		},
		{
			Country: 'Malaysia',
			Function: 'Unknown',
			LOCODE: 'Unknown',
			Name: 'Sipitang',
			NameWoDiac: 'Sipitang',
			Status: 'AI',
			lat: 4.566667,
			long: 103.466667,
			outflows: 3928316,
		},
	],
};

const textarea = document.getElementById('inputTextarea');
const sendButton = document.getElementById('sendButton');
const loader = document.getElementsByClassName('loader')[0];

let map;

const loadMap = (data) => {
	if (!map) {
		anychart.theme('lightEarth');
		map = anychart.map();
		map.geoData('anychart.maps.world');
		map.title('Shipping ports across the globe');
	}

	// create a dataset from data
	var portsDataSet = anychart.data.set(data).mapAs();

	// helper function to create several series
	var createSeries = function (name, data, color) {
		// set the marker series
		var series = map.marker(data);

		// configure the series settings
		series
			.name(name)
			.fill(color)
			.stroke('none')
			.type('circle')
			.size(3)
			.labels(false)
			.selectionMode('none');

		series.legendItem().iconType('circle').iconFill(color);
	};
	// #25c481, #25b7c4;
	// create 5 series, filtering the data by the outflows at each port
	createSeries(
		'Up to 100,000',
		portsDataSet.filter('outflows', filterFunction(0, 100000)),
		'#D1FAE9'
	);
	createSeries(
		'100,000 - 1,000,000',
		portsDataSet.filter('outflows', filterFunction(100000, 1000000)),
		'#9CE0E5'
	);
	createSeries(
		'1,000,000 - 5,000,000',
		portsDataSet.filter('outflows', filterFunction(1000000, 5000000)),
		'#00ACC3'
	);
	createSeries(
		'5,000,000 - 10,000,000',
		portsDataSet.filter('outflows', filterFunction(5000000, 10000000)),
		'#355CB1'
	);
	createSeries(
		'More than 10,000,000 outflows',
		portsDataSet.filter('outflows', filterFunction(10000000, 0)),
		'#002D79'
	);

	// enable and configure the map tooltip
	map.tooltip()
		.useHtml(true)
		.padding([8, 13, 10, 13])
		.width(350)
		.fontSize(12)
		.fontColor('#e6e6e6')
		.titleFormat(function () {
			return this.getData('Name');
		})
		.format(function () {
			return (
				'<span style="color: #bfbfbf">Country: </span>' +
				this.getData('Country') +
				'<br/>' +
				'<span style="color: #bfbfbf">Outflows: </span>' +
				this.getData('outflows').toFixed(0)
			);
		});

	// turn on the map legend
	map.legend(true);

	// add zoom ui controls
	var zoomController = anychart.ui.zoom();
	zoomController.render(map);

	// set the container
	map.container('map-container');

	// draw the map
	map.draw();
};

loadMap(ship_data['ports']);

async function sendData() {
	loader.style.display = 'inline';

	const value = textarea.value;
	const response = await fetch('/search_map_ai', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
		},
		body: JSON.stringify({ value: value }),
	});
	const data = await response.json();

	console.log(data);

	loadMap(data['ports']);
	loader.style.display = 'none';

	// Replace single quotes with double quotes
}

// helper filter function
function filterFunction(val1, val2) {
	if (val2) {
		return function (fieldVal) {
			return val1 <= fieldVal && fieldVal < val2;
		};
	}
	return function (fieldVal) {
		return val1 <= fieldVal;
	};
}

// Function to check if there is text in the textarea and change the button color
function checkTextareaContent() {
	if (textarea.value.trim() !== '') {
		sendButton.classList.add('send-btn-allowed'); // Add the blue-button class
	} else {
		sendButton.classList.remove('send-btn-allowed'); // Remove the blue-button class
	}
}

// Attach an event listener for input in the textarea
textarea.addEventListener('input', checkTextareaContent);

// Initially check textarea content on page load
checkTextareaContent();
